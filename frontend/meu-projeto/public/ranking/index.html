<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Ranking de Jogadores</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: "Poppins", Arial, sans-serif;
            background: linear-gradient(120deg, #4b79a1, #283e51);
            color: #fff;
        }

        h1 {
            text-align: center;
            margin-top: 30px;
            font-size: 38px;
            letter-spacing: 1px;
            text-shadow: 0 3px 5px rgba(0,0,0,0.3);
        }

        #container {
            width: 90%;
            max-width: 900px;
            margin: 40px auto;
        }

        /* SELETOR DE JOGOS */
        #selectJogo {
            padding: 10px;
            font-size: 16px;
            border-radius: 6px;
            border: none;
            margin-top: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255,255,255,0.95);
            border-radius: 12px;
            overflow: hidden;
            color: #333;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        th {
            background: #007bff;
            color: #fff;
            padding: 14px;
            font-size: 18px;
        }

        td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #ddd;
            font-size: 17px;
        }

        tr:hover {
            background: #f0f8ff;
        }

        .gold { color: #e5c100; font-weight: bold; font-size: 22px; }
        .silver { color: #c0c0c0; font-weight: bold; font-size: 22px; }
        .bronze { color: #cd7f32; font-weight: bold; font-size: 22px; }

        .avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
        }

        #loading {
            text-align: center;
            font-size: 22px;
            margin-top: 40px;
            opacity: 0.8;
        }

        #emptyMsg {
            text-align: center;
            font-size: 22px;
            margin-top: 20px;
            color: #ffdfdf;
            display: none;
        }

        @media (max-width: 600px) {
            td, th { font-size: 15px; }
            .avatar { width: 40px; height: 40px; }
        }
    </style>
</head>
<body>

    <h1>üèÜ Ranking de Jogadores</h1>

    <div id="container">

        <!-- SELECTOR DE JOGOS -->
        <div style="text-align:center; margin-bottom:25px;">
            <label for="selectJogo" style="font-size:20px;">Selecione o jogo:</label>
            <select id="selectJogo">
                <option value="">-- Escolha --</option>
            </select>
        </div>

        <div id="boxDificuldade" style="text-align:center; margin-bottom:25px; display:none;">
            <label for="selectDificuldade" style="font-size:20px;">Dificuldade:</label>
            <select id="selectDificuldade">
                <option value="">-- Escolha --</option>
                <option value="facil">F√°cil</option>
                <option value="medio">M√©dio</option>
                <option value="dificil">Dif√≠cil</option>
            </select>
        </div>


        <div id="loading">‚è≥ Carregando ranking...</div>

        <table id="rankingTable" style="display:none;">
            <thead>
                <tr>
                    <th>Posi√ß√£o</th>
                    <th>Jogador</th>
                    <th>Pontos / Vit√≥rias</th>
                    <th>Derrotas</th>
                    <th>Empates</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <div id="emptyMsg">Nenhum jogador encontrado üò¢</div>
    </div>

<script>
    async function carregarJogos() {
        try {
            const resp = await fetch("/api/jogos");
            const jogos = await resp.json();

            const select = document.getElementById("selectJogo");

            jogos.forEach(j => {
                const opt = document.createElement("option");
                opt.value = j.jogo;           // üî• AGORA USA O NOME DO JOGO
                opt.textContent = j.jogo;
                select.appendChild(opt);
            });

        } catch (err) {
            console.error("Erro ao carregar jogos:", err);
        }
    }

    async function carregarRanking(nomeJogo, dificuldade) {
        const loading = document.getElementById("loading");
        const table = document.getElementById("rankingTable");
        const emptyMsg = document.getElementById("emptyMsg");
        const tbody = table.querySelector("tbody");

        tbody.innerHTML = "";
        loading.style.display = "block";
        table.style.display = "none";
        emptyMsg.style.display = "none";

        try {
            // üî• CONSULTA AGORA USA O NOME DO JOGO
            const resp = await fetch(`/api/ranking_nome/${encodeURIComponent(nomeJogo)}/${dificuldade}`);
            const data = await resp.json();

            loading.style.display = "none";

            if (!data.length) {
                emptyMsg.style.display = "block";
                return;
            }

            table.style.display = "table";

            data.forEach((user, index) => {
                const tr = document.createElement("tr");

                const posicao =
                    index === 0 ? '<span class="gold">ü•á</span>' :
                    index === 1 ? '<span class="silver">ü•à</span>' :
                    index === 2 ? '<span class="bronze">ü•â</span>' :
                    index + 1;

                const nome = user.nome || user.name || user.email || "Sem nome";

                const avatarUrl =
                    `https://api.dicebear.com/8.x/initials/svg?seed=${encodeURIComponent(nome)}`;

                tr.innerHTML = `
                    <td>${posicao}</td>
                    <td style="display:flex; align-items:center; gap:10px; justify-content:center;">
                        <img class="avatar" src="${avatarUrl}">
                        ${nome}
                    </td>
                    <td>${user.pontuacao ?? user.vitorias ?? 0}</td>
                    <td>${user.derrotas ?? 0}</td>
                    <td>${user.empates ?? 0}</td>
                `;

                tbody.appendChild(tr);
            });

        } catch (err) {
            loading.textContent = "‚ö† Erro ao carregar ranking";
            console.error(err);
        }
    }

    // QUANDO ESCOLHE O JOGO
    document.getElementById("selectJogo").addEventListener("change", function () {
        const boxDif = document.getElementById("boxDificuldade");
        const jogo = this.value;

        document.getElementById("rankingTable").style.display = "none";

        if (jogo) {
            boxDif.style.display = "block";
        } else {
            boxDif.style.display = "none";
        }
    });

    // QUANDO ESCOLHE A DIFICULDADE
    document.getElementById("selectDificuldade").addEventListener("change", function () {
        const nomeJogo = document.getElementById("selectJogo").value;
        const dificuldade = this.value;

        if (nomeJogo && dificuldade) {
            carregarRanking(nomeJogo, dificuldade);
        }
    });

    carregarJogos();
</script>



</body>
</html>
